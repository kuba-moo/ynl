name: psp

doc:
  PSP Security Protocol Generic Netlink family.

definitions:
  -
    type: enum
    name: version
    entries: [ hdr0-aes-gcm-128, hdr0-aes-gcm-256,
               hdr0-aes-gmac-128, hdr0-aes-gmac-256, ]

attribute-sets:
  -
    name: dev
    attributes:
      -
        name: id
        doc: PSP device ID.
        type: u32
        value: 1
        checks:
          min: 1
      -
        name: ifindex
        doc: ifindex of the main netdevice linked to the PSP device.
        type: u32
      -
        name: psp-versions-cap
        doc: Bitmask of PSP versions supported by the device.
        type: u32
        enum: version
        enum-as-flags: true
      -
        name: psp-versions-ena
        doc: Bitmask of currently enabled (accepted on Rx) PSP versions.
        type: u32
        enum: version
        enum-as-flags: true
  -
    name: keys
    attributes:
      -
        name: pad
        type: pad
        value: 1
      -
        name: dev_id
        doc: PSP device ID.
        type: u32
      -
        name: version
        doc: |
          PSP versions (AEAD and protocol version) used by this association,
          dictates the size of the key.
        type: u32
        enum: version
      -
        name: key
        type: binary
      -
        name: spi
        doc: Security Parameters Index (SPI) of the association.
        type: u32
      -
        name: sock_fd
        doc: Sockets which should be bound to the association immediatelly (optional).
        type: u32

operations:
  list:
    -
      name: dev_get
      doc: Get / dump information about PSP capable devices on the system.
      value: 1
      attribute-set: dev
      do:
        request:
          attributes:
            - id
        reply: &dev-all
          attributes:
            - id
            - ifindex
            - psp-versions-cap
            - psp-versions-ena
        pre: psp-device-get-and-lock
        post: psp-device-unlock
      dump:
        reply: *dev-all
    -
      name: dev_add_ntf
      doc: Notification about device appearing.
      notify: dev_get
      mcgrp: mgmt
    -
      name: dev_del_ntf
      doc: Notification about device disappearing.
      notify: dev_get
      mcgrp: mgmt
    -
      name: dev_set
      doc: Set the configuration of a PSP device.
      attribute-set: dev
      do:
        request:
          attributes:
            - id
            - psp-versions-ena
        pre: psp-device-get-and-lock
        post: psp-device-unlock
    -
      name: dev_change_ntf
      doc: Notification about device configuration being changed.
      notify: dev_get
      mcgrp: mgmt
    -
      name: tx_assoc_add
      doc: Add a key to the Tx association database.
      attribute-set: keys
      do:
        request:
          attributes:
            - version
            - key
            - spi
            - sock_fd
        reply:
          attributes: []

mcast-groups:
  list:
    -
      name: mgmt
