TODO:
 - do the output checks
